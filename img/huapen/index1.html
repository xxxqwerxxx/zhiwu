ä½ åé¦ˆçš„ç°è±¡æ˜¯ï¼š**å›¾ç‰‡åˆæ¬¡ç¼©æ”¾æ—¶ï¼ŒæŒ‰é’®ä»ç„¶ä¼šè·Ÿç€å›¾ç‰‡ç¼©æ”¾ä¸€ç¬é—´ï¼Œç„¶åæ‰æ¢å¤æ­£å¸¸å¤§å°**ã€‚
è¿™æ˜¯å› ä¸ºæŒ‰é’®çš„ `scale(1/inst.scale)`
åç¼©æ”¾æ˜¯åœ¨å›¾ç‰‡çˆ¶å®¹å™¨ï¼ˆwrapperï¼‰ç¼©æ”¾åæ‰ç”Ÿæ•ˆï¼Œæ¸²æŸ“æ—¶æœ‰åŒæ­¥å»¶è¿Ÿï¼Œå¯¼è‡´è§†è§‰ä¸Šæœ‰â€œè·Ÿç€ç¼©æ”¾ä¸€å¸§â€çš„ç°è±¡ã€‚
--- ## å½»åº•è§£å†³æ–¹æ¡ˆ ### åŸå›  - æŒ‰é’®æ˜¯ wrapper çš„å­å…ƒç´ ï¼Œwrapper
ç¼©æ”¾æ—¶ï¼ŒæŒ‰é’®ä¼šå…ˆè¢«ç¼©æ”¾ï¼Œç„¶åå†åå‘ç¼©æ”¾ï¼Œæ¸²æŸ“æœ‰å»¶è¿Ÿã€‚ -
åªæœ‰å°†æŒ‰é’®**ç§»å‡ºç¼©æ”¾å®¹å™¨**ï¼Œå³è®©æŒ‰é’®å’Œå›¾ç‰‡ä¸åœ¨åŒä¸€ä¸ªç¼©æ”¾ä¸Šä¸‹æ–‡ï¼Œæ‰èƒ½å½»åº•é¿å…è¿™ä¸ªé—®é¢˜ã€‚
### è§£å†³åŠæ³• - **å°†æŒ‰é’®ï¼ˆåŠŸèƒ½æŒ‰é’®ã€å±‚çº§æŒ‰é’®ã€æ§åˆ¶ç‚¹ï¼‰æ¸²æŸ“åˆ° pot-area
çš„æœ€å¤–å±‚**ï¼Œç”¨ç»å¯¹å®šä½ï¼ˆabsoluteï¼‰æ ¹æ®å›¾ç‰‡çš„å®é™…ä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬è®¡ç®—å‡ºæŒ‰é’®çš„å‡†ç¡®ä½ç½®ã€‚
- è¿™æ ·æŒ‰é’®ä¸ä¼šè¢«å›¾ç‰‡çš„ scale/rotate
å½±å“ï¼Œè§†è§‰ä¸Šå§‹ç»ˆå¤§å°ä¸å˜ï¼Œä¸”ä¸ä¼šæœ‰â€œè·Ÿç€ç¼©æ”¾ä¸€å¸§â€çš„ç°è±¡ã€‚ --- ##
ä¼˜åŒ–åæ ¸å¿ƒå®ç°æ€è·¯ 1.
æ¸²æŸ“æ‰€æœ‰å›¾ç‰‡ï¼ˆwrapperï¼‰æ—¶ï¼Œè®°å½•æ¯ä¸ªå›¾ç‰‡çš„å®é™…ä¸­å¿ƒç‚¹ã€ç¼©æ”¾ã€æ—‹è½¬ç­‰ä¿¡æ¯ã€‚ 2.
æ¸²æŸ“æŒ‰é’®æ—¶ï¼Œ**å•ç‹¬æ¸²æŸ“**ï¼Œç”¨ JS è®¡ç®—æŒ‰é’®çš„ç»å¯¹ä½ç½®ï¼ˆå¦‚å›¾ç‰‡ä¸‹æ–¹ã€å³ä¾§ç­‰ï¼‰ï¼Œå¹¶ç”¨
transform åªåšæ—‹è½¬ï¼Œä¸åšç¼©æ”¾ã€‚ 3. æ§åˆ¶ç‚¹åŒç†ï¼Œå•ç‹¬æ¸²æŸ“ï¼Œä½ç½®ç”¨ä¸‰è§’å‡½æ•°è®¡ç®—ã€‚ ---
## å®Œæ•´ä¼˜åŒ–ä»£ç  ```html
<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>æ¤ç‰©æ‹–æ‹½èŠ±ç›†ï¼ˆæŒ‰é’®ç»å¯¹å®šä½ä¼˜åŒ–ï¼‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
        background: #f5fff5;
        overflow: hidden;
      }
      body {
        height: 100vh;
        width: 100vw;
      }
      .container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
      }
      .plant-selector-bar {
        height: 15vh;
        min-height: 80px;
        max-height: 160px;
        background: #d0f5d0;
        display: flex;
        align-items: flex-start;
        overflow-x: auto;
        padding: 10px 0;
        box-shadow: 0 2px 8px #0001;
        z-index: 100;
      }
      .plant-item {
        flex: 0 0 auto;
        width: 80px;
        margin: 0 10px;
        text-align: center;
        cursor: grab;
        user-select: none;
      }
      .plant-item img {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        border: 2px solid #b0e0b0;
        background: #fff;
        transition: box-shadow 0.2s;
      }
      .plant-item img:active {
        box-shadow: 0 0 8px #6c6;
      }
      .plant-item span {
        display: block;
        margin-top: 4px;
        font-size: 14px;
        color: #2a4;
      }
      .main-area {
        position: relative;
        flex: 1 1 0;
        height: 85vh;
        min-height: 300px;
        width: 100vw;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f5fff5;
        overflow: hidden;
      }
      .pot-area {
        position: relative;
        width: 400px;
        height: 400px;
        min-width: 220px;
        min-height: 220px;
        max-width: 90vw;
        max-height: 90vh;
        margin: 0 auto;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        background: transparent;
        touch-action: none;
      }
      .pot-img {
        position: absolute;
        left: 50%;
        bottom: 0;
        width: 260px;
        height: 160px;
        transform: translateX(-50%);
        z-index: 0;
        pointer-events: none;
        user-select: none;
      }
      .plant-on-pot-wrapper {
        position: absolute;
        touch-action: none;
        pointer-events: auto;
      }
      .plant-on-pot {
        width: 70px;
        height: 70px;
        border-radius: 12px;
        user-select: none;
        pointer-events: none;
        display: block;
        box-sizing: border-box;
        background: #fff;
        box-shadow: 0 2px 8px #0002;
        transition: box-shadow 0.2s;
      }
      .plant-on-pot.selected {
        box-shadow: 0 0 0 4px #6c6a, 0 2px 8px #0002;
        z-index: 99 !important;
      }
      .pot-area .floating-btn,
      .pot-area .floating-layer-btn,
      .pot-area .floating-handle,
      .pot-area .floating-rotate {
        position: absolute;
        z-index: 300;
        pointer-events: auto;
        user-select: none;
        transition: box-shadow 0.2s, background 0.2s;
      }
      .floating-btn-group {
        display: flex;
        gap: 12px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 12px;
        padding: 6px 14px;
        box-shadow: 0 4px 16px #0002;
        border: 1.5px solid #b0e0b0;
        font-size: 16px;
        align-items: center;
      }
      .floating-btn {
        background: linear-gradient(145deg, #e0ffe0 60%, #b0e0b0 100%);
        border: 1.5px solid #6c6;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 2px 8px #0001;
        display: flex;
        align-items: center;
        justify-content: center;
        outline: none;
      }
      .floating-btn:hover {
        background: linear-gradient(145deg, #b0e0b0 60%, #e0ffe0 100%);
        box-shadow: 0 4px 16px #6c6a;
      }
      .floating-layer-btn-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 12px;
        padding: 6px 4px;
        box-shadow: 0 4px 16px #0002;
        border: 1.5px solid #b0e0b0;
        align-items: center;
      }
      .floating-layer-btn {
        background: linear-gradient(145deg, #e0ffe0 60%, #b0e0b0 100%);
        border: 1.5px solid #6c6;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 2px 8px #0001;
        display: flex;
        align-items: center;
        justify-content: center;
        outline: none;
      }
      .floating-layer-btn:hover {
        background: linear-gradient(145deg, #b0e0b0 60%, #e0ffe0 100%);
        box-shadow: 0 4px 16px #6c6a;
      }
      .floating-handle {
        width: 22px;
        height: 22px;
        background: linear-gradient(145deg, #e0ffe0 60%, #b0e0b0 100%);
        border: 2px solid #6c6;
        border-radius: 50%;
        box-shadow: 0 2px 8px #0002;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }
      .floating-handle svg {
        width: 14px;
        height: 14px;
        pointer-events: none;
      }
      .floating-handle:hover {
        background: linear-gradient(145deg, #b0e0b0 60%, #e0ffe0 100%);
        box-shadow: 0 4px 16px #6c6a;
      }
      .floating-rotate {
        width: 22px;
        height: 22px;
        background: linear-gradient(145deg, #fff 60%, #e0ffe0 100%);
        border: 2px solid #2a4;
        border-radius: 50%;
        box-shadow: 0 2px 8px #0002;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: grab;
      }
      .floating-rotate svg {
        width: 14px;
        height: 14px;
        pointer-events: none;
      }
      .floating-rotate:hover {
        background: linear-gradient(145deg, #b0e0b0 60%, #e0ffe0 100%);
        box-shadow: 0 4px 16px #6c6a;
      }
      @media (max-width: 600px) {
        .pot-area {
          width: 98vw;
          height: 60vw;
          min-width: 160px;
          min-height: 120px;
        }
        .pot-img {
          width: 120px;
          height: 80px;
        }
        .plant-on-pot {
          width: 40px;
          height: 40px;
        }
        .floating-btn,
        .floating-rotate,
        .floating-handle {
          width: 16px;
          height: 16px;
          font-size: 14px;
        }
        .floating-layer-btn {
          width: 20px;
          height: 20px;
          font-size: 12px;
        }
        .floating-btn-group {
          padding: 4px 6px;
        }
        .floating-layer-btn-group {
          padding: 4px 2px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- æ¤ç‰©é€‰æ‹©åŒº -->
      <div class="plant-selector-bar" id="plantSelectorBar"></div>
      <!-- èŠ±ç›†åŒºåŸŸ -->
      <div class="main-area">
        <div class="pot-area" id="potArea">
          <img
            class="pot-img"
            src="./images/plant.jpgg"
            alt="èŠ±ç›†"
            draggable="false"
          />
        </div>
      </div>
    </div>
    <script>
      // æ¤ç‰©ç´ æ
      const plants = [
        { name: "ä»™äººæŒ", img: "./images/plant.jpg" },
        { name: "å‘æ—¥è‘µ", img: "./images/plant.jpg" }
        // { name: "ç«ç‘°", img: "https://img.icons8.com/color/96/rose.png" },
        // { name: "éƒé‡‘é¦™", img: "https://img.icons8.com/color/96/tulip.png" },
        // { name: "æ ‘è‹—", img: "https://img.icons8.com/color/96/seedling.png" },
        // { name: "å¤šè‚‰", img: "https://img.icons8.com/color/96/succulent-plant.png" },
        // { name: "ç«¹å­", img: "https://img.icons8.com/color/96/bamboo.png" }
      ];

      // èŠ±ç›†ä¸Šçš„æ¤ç‰©å®ä¾‹
      let plantInstances = [];
      let selectedId = null;

      // ç”Ÿæˆå”¯ä¸€ID
      function uuid() {
        return "xxxxxx".replace(/x/g, () =>
          ((Math.random() * 36) | 0).toString(36)
        );
      }

      // æ¸²æŸ“æ¤ç‰©é€‰æ‹©åŒº
      const selectorBar = document.getElementById("plantSelectorBar");
      plants.forEach((p, idx) => {
        const div = document.createElement("div");
        div.className = "plant-item";
        div.draggable = true;
        div.innerHTML = `<img src="${p.img}" draggable="false"><span>${p.name}</span>`;
        div.addEventListener("dragstart", e => {
          e.dataTransfer.setData(
            "text/plain",
            JSON.stringify({ plantIdx: idx })
          );
          e.dataTransfer.effectAllowed = "copy";
        });
        selectorBar.appendChild(div);
      });

      // èŠ±ç›†åŒºåŸŸ
      const potArea = document.getElementById("potArea");
      const potImg = potArea.querySelector(".pot-img");

      // æ‹–æ‹½åˆ°èŠ±ç›†
      potArea.addEventListener("dragover", e => {
        e.preventDefault();
        e.dataTransfer.dropEffect = "copy";
      });
      potArea.addEventListener("drop", e => {
        e.preventDefault();
        const data = JSON.parse(e.dataTransfer.getData("text/plain"));
        if (typeof data.plantIdx === "number") {
          // æ–°æ¤ç‰©å®ä¾‹
          const rect = potArea.getBoundingClientRect();
          const x = e.clientX - rect.left - 35;
          const y = e.clientY - rect.top - 35;
          plantInstances.push({
            id: uuid(),
            plantIdx: data.plantIdx,
            x,
            y,
            z: plantInstances.length + 1,
            scale: 1,
            rotate: 0
          });
          selectedId = null;
          renderPlantsOnPot();
        }
        if (data.moveId) {
          // æ‹–åŠ¨å·²å­˜åœ¨çš„æ¤ç‰©
          const rect = potArea.getBoundingClientRect();
          const x = e.clientX - rect.left - 35;
          const y = e.clientY - rect.top - 35;
          const inst = plantInstances.find(p => p.id === data.moveId);
          if (inst) {
            inst.x = x;
            inst.y = y;
            renderPlantsOnPot();
          }
        }
      });

      // æ¸²æŸ“èŠ±ç›†ä¸Šçš„æ¤ç‰©
      function renderPlantsOnPot() {
        // æ¸…é™¤æ—§æ¤ç‰©å’Œæ‰€æœ‰æµ®åŠ¨æŒ‰é’®
        Array.from(
          potArea.querySelectorAll(
            ".plant-on-pot-wrapper, .floating-btn-group, .floating-layer-btn-group, .floating-handle, .floating-rotate"
          )
        ).forEach(el => el.remove());
        // æŒ‰zæ’åº
        plantInstances.sort((a, b) => a.z - b.z);
        plantInstances.forEach((inst, idx) => {
          // wrapper
          const wrapper = document.createElement("div");
          wrapper.className = "plant-on-pot-wrapper";
          wrapper.style.left = inst.x + "px";
          wrapper.style.top = inst.y + "px";
          wrapper.style.zIndex = inst.z;
          wrapper.style.width = "70px";
          wrapper.style.height = "70px";
          wrapper.style.transform = `scale(${inst.scale}) rotate(${inst.rotate}deg)`;
          wrapper.dataset.id = inst.id;
          wrapper.style.transformOrigin = "35px 35px";

          // æ‹–åŠ¨
          let dragOffset = null;
          let isDragging = false;
          wrapper.addEventListener("mousedown", e => {
            if (
              e.target.classList.contains("floating-handle") ||
              e.target.classList.contains("floating-rotate")
            )
              return;
            selectedId = inst.id;
            renderPlantsOnPot();
            dragOffset = { x: e.clientX - inst.x, y: e.clientY - inst.y };
            isDragging = true;
            document.body.style.userSelect = "none";
          });
          document.addEventListener("mousemove", function moveHandler(ev) {
            if (isDragging && selectedId === inst.id) {
              inst.x = ev.clientX - dragOffset.x;
              inst.y = ev.clientY - dragOffset.y;
              wrapper.style.left = inst.x + "px";
              wrapper.style.top = inst.y + "px";
              updateFloatingButtons(inst);
            }
          });
          document.addEventListener("mouseup", function upHandler(ev) {
            if (isDragging && selectedId === inst.id) {
              isDragging = false;
              document.body.style.userSelect = "";
              renderPlantsOnPot();
            }
          });

          // è§¦å±æ‹–åŠ¨
          let touchDragging = false;
          wrapper.addEventListener("touchstart", function(e) {
            if (
              e.target.classList.contains("floating-handle") ||
              e.target.classList.contains("floating-rotate")
            )
              return;
            selectedId = inst.id;
            renderPlantsOnPot();
            let touch = e.touches[0];
            let offsetX = touch.clientX - inst.x;
            let offsetY = touch.clientY - inst.y;
            touchDragging = true;
            function moveHandler(ev) {
              if (!touchDragging) return;
              let t = ev.touches[0];
              inst.x = t.clientX - offsetX;
              inst.y = t.clientY - offsetY;
              wrapper.style.left = inst.x + "px";
              wrapper.style.top = inst.y + "px";
              updateFloatingButtons(inst);
              ev.preventDefault();
            }
            function endHandler(ev) {
              touchDragging = false;
              document.removeEventListener("touchmove", moveHandler);
              document.removeEventListener("touchend", endHandler);
              renderPlantsOnPot();
            }
            document.addEventListener("touchmove", moveHandler, {
              passive: false
            });
            document.addEventListener("touchend", endHandler);
            e.stopPropagation();
          });

          // å›¾ç‰‡
          const el = document.createElement("img");
          el.src = plants[inst.plantIdx].img;
          el.className =
            "plant-on-pot" + (selectedId === inst.id ? " selected" : "");
          el.draggable = false;
          wrapper.appendChild(el);

          potArea.appendChild(wrapper);

          // é€‰ä¸­æ—¶æ¸²æŸ“æµ®åŠ¨æŒ‰é’®å’Œæ§åˆ¶ç‚¹
          if (selectedId === inst.id) {
            renderFloatingButtons(inst);
          }
        });
      }

      // è®¡ç®—å›¾ç‰‡ä¸­å¿ƒç‚¹å’Œå˜æ¢åç‚¹
      function getTransformedPoint(inst, offsetX, offsetY) {
        // å›¾ç‰‡ä¸­å¿ƒç‚¹
        const cx = inst.x + 35;
        const cy = inst.y + 35;
        // æ—‹è½¬
        const rad = (inst.rotate * Math.PI) / 180;
        const dx = offsetX * inst.scale;
        const dy = offsetY * inst.scale;
        const rx = Math.cos(rad) * dx - Math.sin(rad) * dy;
        const ry = Math.sin(rad) * dx + Math.cos(rad) * dy;
        return { x: cx + rx, y: cy + ry };
      }

      // æ¸²æŸ“æµ®åŠ¨æŒ‰é’®å’Œæ§åˆ¶ç‚¹
      function renderFloatingButtons(inst) {
        // åŠŸèƒ½æŒ‰é’®ï¼ˆä¸‹æ–¹ä¸­é—´ï¼‰
        const btnGroup = document.createElement("div");
        btnGroup.className = "floating-btn-group";
        // <button class="floating-btn" title="å¯¼å‡º" onclick="exportPlant('${inst.id}')">ğŸ’¾</button>
        btnGroup.innerHTML = `
        
        <button class="floating-btn" title="å¤åˆ¶" onclick="copyPlant('${inst.id}')">å¤åˆ¶</button>
        <button class="floating-btn" title="åˆ é™¤" onclick="deletePlant('${inst.id}')">åˆ é™¤</button>
      `;
        // ä½ç½®ï¼šå›¾ç‰‡ä¸‹æ–¹ä¸­å¿ƒ
        const pt = getTransformedPoint(inst, 0, 50);
        btnGroup.style.left = pt.x + "px";
        btnGroup.style.top = pt.y + "px";
        btnGroup.style.position = "absolute";
        btnGroup.style.transform = `translate(-50%, 0)`;
        btnGroup.style.zIndex = 300;
        btnGroup.addEventListener("mousedown", e => e.stopPropagation());
        potArea.appendChild(btnGroup);

        // å±‚çº§æŒ‰é’®ï¼ˆå³ä¾§ä¸­é—´ï¼‰
        const layerGroup = document.createElement("div");
        layerGroup.className = "floating-layer-btn-group";
        layerGroup.innerHTML = `
        <button class="floating-layer-btn" title="ç½®é¡¶" onclick="toTop('${inst.id}')">ç½®é¡¶</button>
        <button class="floating-layer-btn" title="ä¸Šç§»" onclick="upLayer('${inst.id}')">ä¸Šç§»</button>
        <button class="floating-layer-btn" title="ä¸‹ç§»" onclick="downLayer('${inst.id}')">ä¸‹ç§»</button>
      `;
        const pt2 = getTransformedPoint(inst, 55, 0);
        layerGroup.style.left = pt2.x + "px";
        layerGroup.style.top = pt2.y + "px";
        layerGroup.style.position = "absolute";
        layerGroup.style.transform = `translate(0, -50%)`;
        layerGroup.style.zIndex = 300;
        layerGroup.addEventListener("mousedown", e => e.stopPropagation());
        potArea.appendChild(layerGroup);

        // æ—‹è½¬ç‚¹ï¼ˆä¸Šæ–¹ä¸­å¿ƒï¼‰
        const rotate = document.createElement("div");
        rotate.className = "floating-rotate";
        rotate.title = "æ—‹è½¬";
        rotate.innerHTML = `<svg viewBox="0 0 24 24"><path d="M12 2v4m0 0a8 8 0 1 1-8 8" stroke="#2a4" stroke-width="2" fill="none"/><polygon points="12,2 9,6 15,6" fill="#2a4"/></svg>`;
        const pt3 = getTransformedPoint(inst, 0, -50);
        rotate.style.left = pt3.x + "px";
        rotate.style.top = pt3.y + "px";
        rotate.style.transform = `translate(-50%, -50%)`;
        rotate.style.zIndex = 300;
        // æ—‹è½¬äº‹ä»¶
        let startAngle = 0,
          startRotate = 0,
          rotating = false;
        rotate.addEventListener("mousedown", function(e) {
          e.stopPropagation();
          const cx = pt3.x,
            cy = pt3.y + 50; // å›¾ç‰‡ä¸­å¿ƒ
          startRotate = inst.rotate;
          startAngle =
            (Math.atan2(e.clientY - cy, e.clientX - cx) * 180) / Math.PI;
          rotating = true;
          function moveHandler(ev) {
            if (!rotating) return;
            const angle =
              (Math.atan2(ev.clientY - cy, ev.clientX - cx) * 180) / Math.PI;
            inst.rotate = startRotate + angle - startAngle;
            renderPlantsOnPot();
          }
          function upHandler(ev) {
            rotating = false;
            document.removeEventListener("mousemove", moveHandler);
            document.removeEventListener("mouseup", upHandler);
          }
          document.addEventListener("mousemove", moveHandler);
          document.addEventListener("mouseup", upHandler);
        });
        // è§¦å±æ—‹è½¬
        rotate.addEventListener("touchstart", function(e) {
          e.stopPropagation();
          const cx = pt3.x,
            cy = pt3.y + 50;
          startRotate = inst.rotate;
          let t = e.touches[0];
          startAngle =
            (Math.atan2(t.clientY - cy, t.clientX - cx) * 180) / Math.PI;
          let touchRotating = true;
          function moveHandler(ev) {
            if (!touchRotating) return;
            let t2 = ev.touches[0];
            const angle =
              (Math.atan2(t2.clientY - cy, t2.clientX - cx) * 180) / Math.PI;
            inst.rotate = startRotate + angle - startAngle;
            renderPlantsOnPot();
            ev.preventDefault();
          }
          function endHandler(ev) {
            touchRotating = false;
            document.removeEventListener("touchmove", moveHandler);
            document.removeEventListener("touchend", endHandler);
          }
          document.addEventListener("touchmove", moveHandler, {
            passive: false
          });
          document.addEventListener("touchend", endHandler);
        });
        potArea.appendChild(rotate);

        // å››è§’ç¼©æ”¾ç‚¹
        const handles = [
          { cls: "nw", dx: -35, dy: -35 },
          { cls: "ne", dx: 35, dy: -35 },
          { cls: "sw", dx: -35, dy: 35 },
          { cls: "se", dx: 35, dy: 35 }
        ];
        handles.forEach(h => {
          const handle = document.createElement("div");
          handle.className = "floating-handle";
          handle.innerHTML = `<svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="4" fill="#6c6"/></svg>`;
          const pt4 = getTransformedPoint(inst, h.dx, h.dy);
          handle.style.left = pt4.x + "px";
          handle.style.top = pt4.y + "px";
          handle.style.transform = `translate(-50%, -50%)`;
          // ç¼©æ”¾äº‹ä»¶
          let startScale = 1,
            startX = 0,
            startY = 0,
            resizing = false;
          handle.addEventListener("mousedown", function(e) {
            e.stopPropagation();
            startScale = inst.scale;
            startX = e.clientX;
            startY = e.clientY;
            resizing = true;
            function moveHandler(ev) {
              if (!resizing) return;
              let dx = (ev.clientX - startX) * (h.dx > 0 ? 1 : -1);
              let dy = (ev.clientY - startY) * (h.dy > 0 ? 1 : -1);
              let delta = Math.max(dx, dy);
              let newScale = Math.max(0.2, startScale + delta / 100);
              inst.scale = newScale;
              renderPlantsOnPot();
            }
            function upHandler(ev) {
              resizing = false;
              document.removeEventListener("mousemove", moveHandler);
              document.removeEventListener("mouseup", upHandler);
            }
            document.addEventListener("mousemove", moveHandler);
            document.addEventListener("mouseup", upHandler);
          });
          // è§¦å±ç¼©æ”¾
          handle.addEventListener("touchstart", function(e) {
            e.stopPropagation();
            startScale = inst.scale;
            let t = e.touches[0];
            startX = t.clientX;
            startY = t.clientY;
            let touchResizing = true;
            function moveHandler(ev) {
              if (!touchResizing) return;
              let t2 = ev.touches[0];
              let dx = (t2.clientX - startX) * (h.dx > 0 ? 1 : -1);
              let dy = (t2.clientY - startY) * (h.dy > 0 ? 1 : -1);
              let delta = Math.max(dx, dy);
              let newScale = Math.max(0.2, startScale + delta / 100);
              inst.scale = newScale;
              renderPlantsOnPot();
              ev.preventDefault();
            }
            function endHandler(ev) {
              touchResizing = false;
              document.removeEventListener("touchmove", moveHandler);
              document.removeEventListener("touchend", endHandler);
            }
            document.addEventListener("touchmove", moveHandler, {
              passive: false
            });
            document.addEventListener("touchend", endHandler);
          });
          potArea.appendChild(handle);
        });
      }

      // æ‹–åŠ¨/ç¼©æ”¾/æ—‹è½¬æ—¶ï¼Œæ›´æ–°æµ®åŠ¨æŒ‰é’®ä½ç½®
      function updateFloatingButtons(inst) {
        // åªæ›´æ–°ä½ç½®ï¼Œä¸é‡æ–°æ¸²æŸ“
        const btnGroup = potArea.querySelector(".floating-btn-group");
        const layerGroup = potArea.querySelector(".floating-layer-btn-group");
        const rotate = potArea.querySelector(".floating-rotate");
        const handles = Array.from(
          potArea.querySelectorAll(".floating-handle")
        );
        if (btnGroup) {
          const pt = getTransformedPoint(inst, 0, 50);
          btnGroup.style.left = pt.x + "px";
          btnGroup.style.top = pt.y + "px";
        }
        if (layerGroup) {
          const pt2 = getTransformedPoint(inst, 55, 0);
          layerGroup.style.left = pt2.x + "px";
          layerGroup.style.top = pt2.y + "px";
        }
        if (rotate) {
          const pt3 = getTransformedPoint(inst, 0, -50);
          rotate.style.left = pt3.x + "px";
          rotate.style.top = pt3.y + "px";
        }
        const handlePos = [
          { dx: -35, dy: -35 },
          { dx: 35, dy: -35 },
          { dx: -35, dy: 35 },
          { dx: 35, dy: 35 }
        ];
        handles.forEach((handle, i) => {
          const pt4 = getTransformedPoint(
            inst,
            handlePos[i].dx,
            handlePos[i].dy
          );
          handle.style.left = pt4.x + "px";
          handle.style.top = pt4.y + "px";
        });
      }

      // å–æ¶ˆé€‰ä¸­
      document.body.addEventListener("mousedown", e => {
        if (!e.target.closest(".plant-on-pot-wrapper")) {
          selectedId = null;
          renderPlantsOnPot();
        }
      });

      // åŠŸèƒ½æŒ‰é’®å®ç°
      window.deletePlant = function(id) {
        plantInstances = plantInstances.filter(p => p.id !== id);
        selectedId = null;
        renderPlantsOnPot();
      };
      window.copyPlant = function(id) {
        const inst = plantInstances.find(p => p.id === id);
        if (inst) {
          plantInstances.push({
            ...inst,
            id: uuid(),
            x: inst.x + 20,
            y: inst.y + 20,
            z: plantInstances.length + 1
          });
          renderPlantsOnPot();
        }
      };
      window.exportPlant = function(id) {
        const inst = plantInstances.find(p => p.id === id);
        if (inst) {
          const link = document.createElement("a");
          link.href = plants[inst.plantIdx].img;
          link.download = plants[inst.plantIdx].name + ".png";
          link.click();
        }
      };
      window.toTop = function(id) {
        const maxZ = Math.max(...plantInstances.map(p => p.z));
        const inst = plantInstances.find(p => p.id === id);
        if (inst) {
          inst.z = maxZ + 1;
          renderPlantsOnPot();
        }
      };
      window.upLayer = function(id) {
        const inst = plantInstances.find(p => p.id === id);
        if (inst) {
          const above = plantInstances
            .filter(p => p.z > inst.z)
            .sort((a, b) => a.z - b.z)[0];
          if (above) {
            [inst.z, above.z] = [above.z, inst.z];
            renderPlantsOnPot();
          }
        }
      };
      window.downLayer = function(id) {
        const inst = plantInstances.find(p => p.id === id);
        if (inst) {
          // èŠ±ç›†z=0ï¼Œä¸èƒ½å†ä½
          const below = plantInstances
            .filter(p => p.z < inst.z)
            .sort((a, b) => b.z - a.z)[0];
          if (below && below.z > 0) {
            [inst.z, below.z] = [below.z, inst.z];
            renderPlantsOnPot();
          }
        }
      };

      // åˆå§‹åŒ–
      renderPlantsOnPot();
    </script>
  </body>
</html>
``` --- **æ ¸å¿ƒä¼˜åŒ–ç‚¹è¯´æ˜ï¼š** -
æ‰€æœ‰æŒ‰é’®ã€æ§åˆ¶ç‚¹éƒ½**ä¸åœ¨å›¾ç‰‡ç¼©æ”¾å®¹å™¨å†…**ï¼Œè€Œæ˜¯ç»å¯¹å®šä½åˆ° pot-areaï¼Œä½ç½®ç”¨ JS
è®¡ç®—ï¼Œè§†è§‰ä¸Šå§‹ç»ˆå¤§å°ä¸å˜ã€‚ -
æŒ‰é’®ç¾è§‚ï¼Œä¸”æ— è®ºå›¾ç‰‡æ€ä¹ˆç¼©æ”¾ã€æ—‹è½¬ï¼ŒæŒ‰é’®éƒ½ä¸ä¼šâ€œè·Ÿç€ç¼©æ”¾ä¸€å¸§â€ã€‚ -
æ‹–åŠ¨ã€ç¼©æ”¾ã€æ—‹è½¬æ—¶ï¼ŒæŒ‰é’®ä½ç½®å®æ—¶æ›´æ–°ã€‚ - å…¼å®¹ PC å’Œè§¦å±ã€‚
å¦‚éœ€è¿›ä¸€æ­¥ç¾åŒ–æˆ–åŠŸèƒ½æ‰©å±•ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼
